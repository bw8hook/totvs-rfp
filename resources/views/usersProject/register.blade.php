<x-app-layout>
    <div style=" padding-bottom: 130px;">
        <div class="max-w-7xl mx-auto space-y-6">
    

            <div class="list-form" style="padding-top:0px;">
                  
                <div id="titleComponentForm" class=" flex items-center justify-between px-4 space-x-2 relative">
                    <div class="flex items-center space-x-2" style="display: block; margin-left: 30px;">
                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline; margin-top: 3px; width: 27px; margin-right: 1px;">
                            <g clip-path="url(#clip0_1008_10453)">
                                <path d="M13.2 15.0933C11.9184 15.0933 10.6656 14.7133 9.59993 14.0012C8.5343 13.2892 7.70374 12.2772 7.21328 11.0931C6.72283 9.90903 6.5945 8.60612 6.84454 7.34912C7.09457 6.09212 7.71173 4.9375 8.61797 4.03125C9.52422 3.12501 10.6788 2.50785 11.9358 2.25782C13.1928 2.00778 14.4957 2.13611 15.6798 2.62656C16.8639 3.11702 17.8759 3.94758 18.5879 5.01321C19.3 6.07884 19.68 7.33168 19.68 8.6133C19.6781 10.3313 18.9948 11.9784 17.78 13.1933C16.5651 14.4081 14.918 15.0914 13.2 15.0933ZM13.2 5.0133C12.488 5.0133 11.792 5.22444 11.2 5.62001C10.608 6.01559 10.1465 6.57783 9.87406 7.23564C9.60158 7.89346 9.53029 8.6173 9.6692 9.31563C9.8081 10.014 10.151 10.6554 10.6544 11.1589C11.1579 11.6624 11.7994 12.0052 12.4977 12.1441C13.196 12.283 13.9199 12.2117 14.5777 11.9393C15.2355 11.6668 15.7977 11.2054 16.1933 10.6134C16.5889 10.0213 16.8 9.32532 16.8 8.6133C16.8 7.65852 16.4207 6.74285 15.7456 6.06772C15.0705 5.39259 14.1548 5.0133 13.2 5.0133ZM24 29.4933V28.7733C24 25.909 22.8622 23.1619 20.8368 21.1366C18.8114 19.1112 16.0644 17.9733 13.2 17.9733C10.3357 17.9733 7.58866 19.1112 5.56327 21.1366C3.53788 23.1619 2.40002 25.909 2.40002 28.7733L2.40002 29.4933C2.40002 29.8752 2.55174 30.2415 2.82179 30.5115C3.09184 30.7816 3.45811 30.9333 3.84002 30.9333C4.22194 30.9333 4.58821 30.7816 4.85826 30.5115C5.12831 30.2415 5.28002 29.8752 5.28002 29.4933V28.7733C5.28002 26.6728 6.11445 24.6583 7.59974 23.173C9.08503 21.6877 11.0995 20.8533 13.2 20.8533C15.3005 20.8533 17.315 21.6877 18.8003 23.173C20.2856 24.6583 21.12 26.6728 21.12 28.7733V29.4933C21.12 29.8752 21.2717 30.2415 21.5418 30.5115C21.8118 30.7816 22.1781 30.9333 22.56 30.9333C22.9419 30.9333 23.3082 30.7816 23.5783 30.5115C23.8483 30.2415 24 29.8752 24 29.4933Z" fill="#5570F1"/>
                                <path d="M30.4 24.8001C30.4 28.7703 27.1702 32.0001 23.2 32.0001C19.2298 32.0001 16 28.7703 16 24.8001C16 20.8299 19.2298 17.6001 23.2 17.6001C27.1702 17.6001 30.4 20.8299 30.4 24.8001Z" fill="#5570F1"/>
                                <path d="M23.9997 25.6L26.5937 25.6C27.0361 25.6 27.3936 25.2425 27.3936 24.8001C27.3936 24.3578 27.0361 24.0003 26.5937 24.0003L23.9997 24.0003L23.9997 21.4062C23.9997 20.9639 23.6422 20.6064 23.1998 20.6064C22.7575 20.6064 22.4 20.9639 22.4 21.4062L22.4 24.0003L19.8059 24.0003C19.3636 24.0003 19.0061 24.3578 19.0061 24.8001C19.0061 25.0207 19.0955 25.221 19.2403 25.3658C19.3851 25.5106 19.5853 25.6 19.8059 25.6L22.4 25.6L22.4 28.194C22.4 28.4146 22.4894 28.6149 22.6342 28.7597C22.779 28.9045 22.9792 28.9939 23.1998 28.9939C23.6422 28.9939 23.9997 28.6364 23.9997 28.194L23.9997 25.6Z" fill="white"/>
                            </g>
                            <defs>
                                <clipPath id="clip0_1008_10453">
                                    <rect width="32" height="32" fill="white"/>
                                </clipPath>
                            </defs>
                        </svg>

                        <div style="display: inline-grid; width: 94%;">
                            <span style="color: #141824; font-size: 22px; font-weight: 600; line-height: 28.6px; text-align: left;">Cadastro de Novo Usuário</span>
                            <div style="color:#8A94AD; font-size: 16px; font-weight: 400; line-height: 28.6px; text-align: left;">Informe corretamente os dados de acesso do novo usuário a ser cadastrado. Após isso, confirme as informações e enviaremos um e-mail de confirmação de acesso ao usuário.</div>
                        </div>
                    </div>
                </div>

                <form method="POST" action="{{ route('users.register') }}" enctype="multipart/form-data" style=" margin: auto; width: 65%; min-width: 450px; background: #FFF; box-shadow: 0px 4px 28px rgba(0, 0, 0, 0.1); border-radius: 15px; padding: 50px 15%;">
                @csrf

                <div class="img_profile">
                    <input type="file" id="photo-upload" name="profile_picture" accept="image/*">

                    <svg width="70px" height="70px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 17V9C21 7.89543 20.1046 7 19 7H16.5C15.9477 7 15.5 6.55228 15.5 6C15.5 5.44772 15.0523 5 14.5 5H9.5C8.94772 5 8.5 5.44772 8.5 6C8.5 6.55228 8.05228 7 7.5 7H5C3.89543 7 3 7.89543 3 9V17C3 18.1046 3.89543 19 5 19H19C20.1046 19 21 18.1046 21 17Z" stroke="#000000" stroke-width="1.5"/>
                        <path d="M15 13C15 14.6569 13.6569 16 12 16C10.3431 16 9 14.6569 9 13C9 11.3431 10.3431 10 12 10C13.6569 10 15 11.3431 15 13Z" stroke="#000000" stroke-width="1.5"/>
                    </svg>

                    <div class="preview">
                        <img src="" alt="">
                    </div>

                    <span class="preview_chamada">Editar imagem</span>
                </div>
                
                <!-- Name -->
                <div>
                    <x-input-label for="name" :value="__('Nome')" />
                    <x-text-input id="name" class="block mt-1 w-full" type="text" name="name" value="" required autofocus autocomplete="name" />
                    <x-input-error :messages="$errors->get('name')" class="mt-2" />
                </div>

                <!-- Email Address -->
                <div class="mt-4">
                    <x-input-label for="email" :value="__('Email')" />
                    <x-text-input id="email" class="block mt-1 w-full" type="email" name="email"  value="" required  />
                    <x-input-error :messages="$errors->get('email')" class="mt-2" />
                </div>
                
                 <!-- ID TOTVS -->
                 <div class="mt-4">
                    <x-input-label for="idtotvs" :value="__('ID TOTVS')" />
                    <x-text-input id="idtotvs" class="block mt-1 w-full" type="text" name="idtotvs"  value="" />
                    <x-input-error :messages="$errors->get('idtotvs')" class="mt-2" />
                </div>


                <!-- ID TOTVS -->
                <div class="mt-4">
                    <x-input-label for="position" :value="__('Cargo')" />
                    <x-text-input id="position" class="block mt-1 w-full" type="text" name="position"  value=" " />
                    <x-input-error :messages="$errors->get('position')" class="mt-2" />
                </div>

                <!-- SETOR -->
                <div class="mt-4">
                    <x-input-label for="departament_id" :value="__('Setor')" />
                    <select name="departament[]"  class="form-control">
                        <option selected disabled>Selecione um Setor</option>
                        @foreach($userDepartaments as $userDepartament)
                            <option value="{{$userDepartament->id}}" >{{$userDepartament->departament}}</option>
                        @endforeach
                    </select>
                    <x-input-error :messages="$errors->get('departament')" class="mt-2" />
                </div>
                
               

  
               <!-- TIPO DE CONTA -->
               <div class="mt-4">
                    <x-input-label for="account_type" :value="__('Tipo de Conta')" />
                    <select name="account_type[]"  class="form-control">
                        @foreach($roles as $role)
                            <option value="{{$role->name}}" >{{$role->name}}</option>
                        @endforeach
                    </select>
                    <x-input-error :messages="$errors->get('account_type')" class="mt-2" />
                </div>
          
                <div class="flex items-center justify-end mt-3">
                    <button type="submit" class=" inline-flex items-center rounded-md font-semibold text-xs text-white btn_enviar" style="height: 46px; display: inline;">
                        <span>Cadastrar</span>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline;">
                            <path d="M13.5817 6.90667L14.7517 8.09417L9.92417 12.85C9.60167 13.1725 9.1775 13.3333 8.75167 13.3333C8.32583 13.3333 7.8975 13.1708 7.57167 12.8458L5.25333 10.5992L6.41417 9.40167L8.74167 11.6575L13.5817 6.90667ZM20 10C20 15.5142 15.5142 20 10 20C4.48583 20 0 15.5142 0 10C0 4.48583 4.48583 0 10 0C15.5142 0 20 4.48583 20 10ZM18.3333 10C18.3333 5.405 14.595 1.66667 10 1.66667C5.405 1.66667 1.66667 5.405 1.66667 10C1.66667 14.595 5.405 18.3333 10 18.3333C14.595 18.3333 18.3333 14.595 18.3333 10Z" fill="white"/>
                        </svg>

                    </button>
                </div>

                <a href="" class="btn_voltar">Voltar</a>

            </form>
        </div>


           
        </div>
    </div>
</x-app-layout>

<script>

function checkboxDropdown(el) {
  var $el = $(el)

  function updateStatus(label, result) {
    if(!result.length) {
      label.html('Select Options');
    }
  };
  
  $el.each(function(i, element) {
    var $list = $(this).find('.dropdown-list'),
      $label = $(this).find('.dropdown-label'),
      $checkAll = $(this).find('.check-all'),
      $inputs = $(this).find('.check'),
      defaultChecked = $(this).find('input[type=checkbox]:checked'),
      result = [];
    
    updateStatus($label, result);
    if(defaultChecked.length) {
      defaultChecked.each(function () {
        result.push($(this).next().text());
        $label.html(result.join(", "));
      });
    }
    
    $label.on('click', ()=> {
      $(this).toggleClass('open');
    });

    $checkAll.on('change', function() {
      var checked = $(this).is(':checked');
      var checkedText = $(this).next().text();
      result = [];
      if(checked) {
        result.push(checkedText);
        $label.html(result);
        $inputs.prop('checked', false);
      }else{
        $label.html(result);
      }
        updateStatus($label, result);
    });

    $inputs.on('change', function() {
      var checked = $(this).is(':checked');
      var checkedText = $(this).next().text();
      if($checkAll.is(':checked')) {
        result = [];
      }
      if(checked) {
        result.push(checkedText);
        $label.html(result.join(", "));
        $checkAll.prop('checked', false);
      }else{
        let index = result.indexOf(checkedText);
        if (index >= 0) {
          result.splice(index, 1);
        }
        $label.html(result.join(", "));
      }
      updateStatus($label, result);
    });

    $(document).on('click touchstart', e => {
      if(!$(e.target).closest($(this)).length) {
        $(this).removeClass('open');
      }
    });
  });
};

checkboxDropdown('.dropdown');


</script>


<script>
        const fileInput = document.getElementById('photo-upload');
        const previewContainer = document.querySelector('.preview');
        const previewText = previewContainer.querySelector('span');

        fileInput.addEventListener('change', function() {
            const file = this.files[0];

            if (file) {
                const reader = new FileReader();

                reader.addEventListener('load', function() {
                    const imgElement = document.createElement('img');
                    imgElement.src = this.result;

                    // Limpa o preview anterior e adiciona a nova imagem
                    previewContainer.innerHTML = '';
                    previewContainer.appendChild(imgElement);
                });

                reader.readAsDataURL(file);
            } else {
                // Volta ao estado inicial se nenhum arquivo for selecionado
                previewContainer.innerHTML = '';
            }
        });
    </script>